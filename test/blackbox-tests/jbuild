(jbuild_version 1)

(library
 ((name platform)
  (modules (platform))
  (libraries (stdune))))

(executable
 ((name cram)
  (modules (cram))
  (libraries (test_common platform dune configurator))))

(ocamllex (cram))

(executable
 ((name gen_tests)
  (libraries (stdune platform usexp))
  (modules (gen_tests))))

(include jbuild.inc)

(rule
 ((targets (jbuild.inc.gen))
  (deps ((files_recursively_in test-cases)))
  (action (with-stdout-to ${@} (run ./gen_tests.exe)))))

(alias
 ((name runtest)
  (action (diff jbuild.inc jbuild.inc.gen))))
